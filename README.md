# Open Repertoire Interchange Format (ORIF)

The *Open Repertoire Interchange Format* (ORIF) enables theaters to share comprehensive information about their productions and events in a machine-readable, standardized format.
This specification builds on [schema.org](https://schema.org) to provide a structured approach to exchanging theatrical repertoire data across different institutions and platforms.

This repository contains the specification of the ORIF data model in the form of an OpenAPI definition,
as well as the code for two tools: a [schema validator](https://buehnenverein.github.io/open-repertoire/validate) and a [data viewer](https://buehnenverein.github.io/open-repertoire/view)
(to display ORIF data in a human-readable form).

[Documentation](https://buehnenverein.github.io/open-repertoire/)

# Repository Structure
- `openapi.yml`: Entry point of the OpenAPI definition for ORIF
- `schemas/`: contains sub-schemas
- `elm/`: contains the Elm-code for the validator and view tools
- `validate/` and `view/`: contain the required HTML and assets for both tools

# Setup
If you want to make changes to the documentation or supporting tools for ORIF,
the easiest way to set up a working development environment is to use the nix flake.
It will give you easy access to a development shell and automatically install all required dependencies.
However, you can also set up your development environment manually.

## Method 1: Using nix flake
1. [Install nix](https://nix.dev/install-nix.html)
2. Enter the development shell with `nix develop --no-pure-eval`
5. Run `make` to build the OpenAPI documentation and tools

## Method 2: Manually
1. Install [Node.js](https://nodejs.org/en/download), [Elm](https://guide.elm-lang.org/install/elm), and [Elixir](https://elixir-lang.org/install.html)
4. Run `npm install` to install dependencies
5. Run `make` to build the OpenAPI documentation and tools

# Development
When working on the schema definitions, i.e. to update the ORIF data model, it's recommended to run:
```bash
npx redocly preview-docs openapi.yml
```
This will start a server that watches the schema files and renders a preview of the docs at
[localhost:8080](localhost:8080).

When making changes to the tools, you can also start a server that watches for changes and automatically
reloads the page. To do that, if you're using the nix development environment, run:
```bash
devenv up
```

If you instead set up your environment manually, you need to manually start a HTTP server that serves the
files in the `build/` directory and run `elm-watch`. E.g.:
```bash
npx http-server build/ & # serve files from the build/ directory
cd elm && npx elm-watch hot # watch for changes to the elm files automatically
```

## Auto-generated code
The Elm code includes model files for the entire ORIF data model.
These files are being auto-generated by 
[json-schema-to-elm](https://github.com/buehnenverein/json-schema-to-elm)
based on the schema files.

Code generation happens automatically when the `make` process is run. The results are placed in `js2e_output/`
and are also copied to `elm/src/Data` and `elm/src/Helper` for compilation.

# Release
To release changes to the data model (OpenAPI documentation) or tools, you just need to merge your changes into
the branch `release-v2` and push that branch. There's a GitHub Workflow defined in `.github/workflows/static.yml`
that will build and upload the project.
